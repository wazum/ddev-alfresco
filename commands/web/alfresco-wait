#!/bin/bash
#ddev-generated

## Description: Wait for Alfresco to be ready
## Usage: alfresco-wait
## Example: "ddev alfresco-wait"

MAX_ATTEMPTS=120
ATTEMPT=0

echo "Waiting for Alfresco to be ready..."

while [ $ATTEMPT -lt $MAX_ATTEMPTS ]; do
    if curl -f -s -u admin:admin http://alfresco:8080/alfresco/api/-default-/public/alfresco/versions/1/probes/-ready- > /dev/null 2>&1; then
        echo "✓ Alfresco is ready!"
        PRIMARY_HOSTNAME=$(echo ${DDEV_PRIMARY_URL} | sed 's|https://||')
        echo "  Alfresco: https://${PRIMARY_HOSTNAME}:8081/alfresco"
        echo "  Share: https://${PRIMARY_HOSTNAME}:8081/share"
        echo "  Default credentials: admin/admin"
        exit 0
    fi

    ATTEMPT=$((ATTEMPT + 1))
    echo -n "."
    sleep 5
done

echo ""
echo "✗ Timeout waiting for Alfresco to be ready"
echo "  Check logs with: ddev logs -s alfresco"
exit 1
